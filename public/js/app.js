"use strict";var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function wrt(e){console.log(e)}var Modal=function(){function e(t){_classCallCheck(this,e),this.modal=t,this.docBody=document.querySelector("body")}return _createClass(e,[{key:"closeAnimEnd",value:function(){this.modal.classList.contains("fadeIn")?(this.modal.classList.remove("fadeIn"),this.docBody.classList.add("modal-opened")):this.modal.classList.contains("fadeOut")&&(this.modal.style.display="none",this.modal.classList.remove("fadeOut"),this.docBody.classList.remove("modal-opened"))}},{key:"open",value:function(){this.modal.style.display="flex",this.modal.classList.remove("fadeOut"),this.modal.classList.add("fadeIn")}},{key:"close",value:function(){this.modal.classList.remove("fadeIn"),this.modal.classList.add("fadeOut")}},{key:"init",value:function(){var e=this;this.modal.querySelector(".js-modal-close").addEventListener("click",function(){e.close()}),this.modal.addEventListener("webkitAnimationEnd",function(){e.closeAnimEnd()}),this.modal.addEventListener("animationend",function(){e.closeAnimEnd()}),window.addEventListener("click",function(t){t.target===e.modal&&e.close()})}}]),e}(),Server=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getFeed",value:function(){return fetch("./src/js/feed.json",{method:"GET"})}},{key:"getCard",value:function(e){return fetch("./src/js/feed.json",{method:"GET"}).then(function(e){return e.json()}).then(function(t){return t.find(function(t,r){if(t.id===Number(e))return t})})}}]),e}(),ImageSidebar=function(){function e(t){_classCallCheck(this,e),this.sidebar=document.querySelector("."+t.sidebar),this.art=document.querySelector("."+t.art),this.descr=document.querySelector("."+t.descr),this.state=!0}return _createClass(e,[{key:"toggle",value:function(){this.state?(this.descr.style.transform="translateX(600px)",this.art.style.transform="translateX(0px)",this.state=!1):(this.descr.style.transform="translateX(0px)",this.art.style.transform="translateX(-600px)",this.state=!0)}}]),e}(),imageSidebar=new ImageSidebar({sidebar:"image-sidebar",art:"image-art",descr:"image-infoblock"}),_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=document.querySelectorAll(".js-image-sidebar-toggle")[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var btn=_step.value;btn.addEventListener("click",function(){imageSidebar.toggle()})}}catch(e){_didIteratorError=!0,_iteratorError=e}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}var ImageLoader=function(){function e(t){_classCallCheck(this,e),this.dropArea=t,this.dropAreaInner=this.dropArea.firstElementChild,this.inputReplacer=document.querySelector(".js-upload-input-replacer"),this.input=document.querySelector(".js-upload-input"),this.preview=document.querySelector(".js-upload-image-preview"),this.modalOpenBtn=document.querySelector(".js-upload-pic-btn"),this.modalUploadCancelBtn=document.querySelector(".js-upload-cancel"),this.modalUploadAcceptBtn=document.querySelector(".js-upload-accept"),this.modal=new Modal(document.querySelector(".js-upload-modal")),this.modal.init()}return _createClass(e,[{key:"getPreviewImg",value:function(e){if(e.length&&-1!==e[0].type.indexOf("image"))return URL.createObjectURL(e[0])}},{key:"showPreviewImg",value:function(e){var t=document.createElement("img");t.src=e,t.addEventListener("load",function(e){URL.revokeObjectURL(e.target.src)}),this.removePreviewImg(),this.preview.appendChild(t)}},{key:"removePreviewImg",value:function(){this.preview.textContent=""}},{key:"uploadCancel",value:function(){this.modal.close(),this.removePreviewImg()}},{key:"init",value:function(){var e=this;this.input.addEventListener("change",function(t){t.preventDefault();var r=e.getPreviewImg(t.currentTarget.files);e.showPreviewImg(r)}),this.dropArea.addEventListener("drop",function(t){t.preventDefault();var r=e.getPreviewImg(t.dataTransfer.files);e.showPreviewImg(r),e.dropArea.classList.remove("upload-modal__drop-area_dragover")}),this.dropArea.addEventListener("dragover",function(t){t.preventDefault(),t.target!==e.dropArea&&t.target!==e.dropAreaInner||e.dropArea.classList.add("upload-modal__drop-area_dragover")}),this.inputReplacer.addEventListener("click",function(){e.input.click()}),this.modalOpenBtn.addEventListener("click",function(t){e.modal.open()}),this.modalUploadCancelBtn.addEventListener("click",function(t){e.uploadCancel()})}}]),e}(),dropArea=new ImageLoader(document.querySelector(".js-drop-area"));dropArea.init();var Feed=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"createStat",value:function(e,t){var r=document.createElement("td"),n=document.createElement("p");n.classList.add("stat","js-stat-likes"),r.appendChild(n);var a=document.createElement("span");a.classList.add(e),n.appendChild(a);var o=document.createElement("span");return o.textContent=t,n.appendChild(o),r}},{key:"createCard",value:function(t){var r=document.createElement("div");r.classList.add("card-thumbnail"),r.dataset.id=t.id;var n=document.createElement("div");n.classList.add("card-thumbnail__overlay"),r.appendChild(n);var a=document.createElement("div");a.classList.add("card-thumbnail__stats","stats"),r.appendChild(a);var o=document.createElement("table");a.appendChild(o);var i=document.createElement("tr");i.appendChild(e.createStat("icon-heart",t.likes)),i.appendChild(e.createStat("icon-bubble",t.comments)),o.appendChild(i.cloneNode(!0)),i.textContent="",i.appendChild(e.createStat("icon-eye",t.seen)),i.appendChild(e.createStat("icon-pencil",t.art)),o.appendChild(i);var s=document.createElement("img");return s.src=t.src,r.appendChild(s),r}},{key:"renderFeed",value:function(t){var r=0,n=document.createDocumentFragment(),a=!0,o=!1,i=void 0;try{for(var s,c=t[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var l=s.value;if(0===r){var d=document.createElement("div");d.classList.add("row"),n.appendChild(d)}var u=n.lastElementChild,m=document.createElement("div");m.classList.add("col-sm-4"),u.appendChild(m),m.appendChild(e.createCard(l)),3==++r&&(r=0)}}catch(e){o=!0,i=e}finally{try{!a&&c.return&&c.return()}finally{if(o)throw i}}e.feed.textContent="",e.feed.appendChild(n)}},{key:"updFeed",value:function(){Server.getFeed().then(function(e){return e.json()}).then(function(t){return e.renderFeed(t)})}},{key:"feed",get:function(){return document.querySelector(".js-feed")}}]),e}();Feed.updFeed();var ShowPicModal=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.pic=e.querySelector(".js-image-natural"),r.likes=e.querySelector(".js-image-like-counter"),r.comments=e.querySelector(".js-image-comment-counter"),r.seen=e.querySelector(".js-image-seen-counter"),r.art=e.querySelector(".js-art-counter"),r.author=e.querySelector(".js-image-author"),r.postDate=e.querySelector(".js-image-date"),r.tags=e.querySelector(".js-image-hashtags"),r.commentsList=e.querySelector(".image-comments"),r.description=e.querySelector(".js-image-description"),r}return _inherits(t,Modal),_createClass(t,[{key:"updateModalData",value:function(e){var t=this;return Server.getCard(e.dataset.id).then(function(e){t.pic.textContent="";var r=document.createElement("img");return r.src=e.src,t.pic.appendChild(r),e}).then(function(e){return t.likes.textContent=e.likes,t.comments.textContent=e.comments,t.seen.textContent=e.seen,t.art.textContent=e.art,e}).then(function(e){t.author.textContent=e.author,t.postDate.textContent=e.timestamp,t.description.textContent=e.description})}},{key:"showPic",value:function(e){var t=this;this.updateModalData(e).then(function(){t.open()})}}]),t}(),showPicModal=new ShowPicModal(document.querySelector(".js-show-pic-modal"));showPicModal.init(),document.querySelector(".js-feed").addEventListener("click",function(e){var t=!0,r=!1,n=void 0;try{for(var a,o=e.path[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i=a.value;if(i.classList.contains("card-thumbnail")){showPicModal.showPic(i);break}if("BODY"===i.tagName)break}}catch(e){r=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw n}}});